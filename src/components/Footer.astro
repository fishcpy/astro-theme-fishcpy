---
import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>
<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6">
    <div class="flex flex-col items-center gap-2">
        <a href="https://www.travellings.cn/go.html" 
        target="_blank" 
        rel="noopener" 
        title="开往-友链接力"
        class="transition hover:opacity-80">
        <img src="https://www.travellings.cn/assets/logo.gif" 
            alt="开往-友链接力" 
            width="120">
        </a>

        <div class="text-center">
            <a href="https://beian.miit.gov.cn" target="_blank" class="transition link text-[var(--primary)] font-medium text-base">京ICP备2025138063号</a>
        </div>

        <div class="flex justify-center gap-4 mt-2">
            <a href="https://hopedomain.com/zh/age/fis.ink" target="_blank">
                <img src="https://hopedomain.com/api/badge/domain-age/fis.ink?theme=spotify&lang=zh" alt="域名年龄" />
            </a>
            <a href="https://ipw.cn/ssl/?site=blog.fis.ink" title="本站支持SSL安全访问" target="_blank">
                <img style="display:inline-block;vertical-align:middle" alt="本站支持SSL安全访问" src="https://static.ipw.cn/icon/ssl-s1.svg" />
            </a>
        </div>

        <div id="runtime_span" class="text-xs text-50"></div>
        
        <div class="flex flex-wrap justify-center gap-4 text-sm mt-2">
            <a href="https://icp.gov.moe/?keyword=20241732" target="_blank" class="transition link text-[var(--primary)]">萌备20241732号</a>
            <a href='https://icp.fishcpy.top/query.php?keyword=20252224' class="transition link text-[var(--primary)]">鱼备20252224</a>
            <a href="https://icp.wudu.ltd/xg.php?keyword=fishcpy" target="_blank"><img src="https://shields.wudu.ltd/gen.php?part1=雾备&part2=fishcpy&url=https://icp.wudu.ltd/id.php?keyword=fishcpy&style=blue" alt="雾备案标识"></a>
            <a href="http://icpgov.xin/beian/ICP-1145141145.html" class="transition link text-[var(--primary)]">酱1145141145号</a>
            <a href="https://icp.6uu.us/query.php?icp_number=%E5%85%83-92291" class="transition link text-[var(--primary)]">元-92291</a>
        </div>
        
        <!-- 版权和基础信息 -->
        <div class="transition text-50 text-sm text-center mt-4">
            &copy; 2024-<span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved. /
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> /
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>Sitemap</a><br>
            Powered by
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">fishcpy Theme</a><br>
            Server by
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://edgeone.ai">Tencent EO Pages</a> &
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://edgeone.ai">Tencent EO CDN</a> &
            <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://www.cloudflare.com">Cloudflare Pages</a><br>
            <div id="performance_info" class="text-xs text-50 mt-1"></div>
        </div>
    </div>
</div>

<script is:inline>
function show_runtime(){
    window.setTimeout("show_runtime()",1000);
    X = new Date("9/6/2024 00:00:00");
    Y = new Date();
    T = (Y.getTime() - X.getTime());
    M = 24 * 60 * 60 * 1000;
    a = T / M;
    A = Math.floor(a);
    b = (a - A) * 24;
    B = Math.floor(b);
    c = (b - B) * 60;
    C = Math.floor(c);
    D = Math.floor((c - C) * 60);
    document.getElementById('runtime_span').innerHTML = "本站已十分不安全的运行了" + A + "天" + B + "小时" + C + "分" + D + "秒"
}

(function() {
    let startTime = Date.now();
    let loadingTimer = null;
    let isPageLoaded = false;

    function updateLoadingTime() {
        const performanceElement = document.getElementById('performance_info');
        if (!performanceElement) return;
        
        if (!isPageLoaded) {
            const currentTime = Date.now() - startTime;
            
            // 获取内存信息（如果浏览器支持）
            let memoryInfo = '';
            if (window.performance && window.performance.memory) {
                const memory = window.performance.memory;
                const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                memoryInfo = ` | 内存占用: ${usedMB}MB`;
            }
            
            performanceElement.innerHTML = `页面加载时间: ${currentTime}ms${memoryInfo}`;
            
            // 每100毫秒更新一次加载时间
            loadingTimer = setTimeout(updateLoadingTime, 100);
        }
    }

    function showFinalLoadTime() {
        const performanceElement = document.getElementById('performance_info');
        if (!performanceElement) return;
        
        isPageLoaded = true;
        
        // 清除加载计时器
        if (loadingTimer) {
            clearTimeout(loadingTimer);
            loadingTimer = null;
        }
        
        // 获取最终的页面加载时间
        let finalLoadTime;
        if (window.performance && window.performance.timing && window.performance.timing.loadEventEnd > 0) {
            finalLoadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
        } else {
            finalLoadTime = Date.now() - startTime;
        }
        
        // 获取内存信息（如果浏览器支持）
        let memoryInfo = '';
        if (window.performance && window.performance.memory) {
            const memory = window.performance.memory;
            const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
            memoryInfo = ` | 内存占用: ${usedMB}MB`;
        }
        
        performanceElement.innerHTML = `页面加载时间: ${finalLoadTime}ms${memoryInfo}`;
        
        // 开始定期更新内存信息
        updateMemoryInfo();
    }

    function updateMemoryInfo() {
        const performanceElement = document.getElementById('performance_info');
        if (!performanceElement || !isPageLoaded) return;
        
        // 只更新内存信息部分
        if (window.performance && window.performance.memory) {
            const memory = window.performance.memory;
            const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
            const currentContent = performanceElement.innerHTML;
            const loadTimePart = currentContent.split(' | ')[0];
            performanceElement.innerHTML = `${loadTimePart} | 内存占用: ${usedMB}MB`;
        }
        
        // 每5秒更新一次内存信息
        setTimeout(updateMemoryInfo, 5000);
    }
    
    // 立即开始显示加载时间计时
    updateLoadingTime();

    // 等待页面完全加载后显示最终加载时间
    if (document.readyState === 'complete') {
        showFinalLoadTime();
    } else {
        window.addEventListener('load', showFinalLoadTime);
    }
})();

show_runtime();
</script>